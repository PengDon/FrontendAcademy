<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Electron 窗口管理示例</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    h1 {
      color: #2c3e50;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
      margin-top: 0;
    }
    
    h2 {
      color: #34495e;
      margin-top: 30px;
      border-left: 4px solid #3498db;
      padding-left: 10px;
    }
    
    .section {
      margin-bottom: 30px;
      padding: 20px;
      background-color: #f9f9f9;
      border-radius: 6px;
    }
    
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    button {
      padding: 10px 15px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s, transform 0.1s;
    }
    
    button:hover {
      background-color: #2980b9;
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    .secondary-button {
      background-color: #95a5a6;
    }
    
    .secondary-button:hover {
      background-color: #7f8c8d;
    }
    
    .success-button {
      background-color: #2ecc71;
    }
    
    .success-button:hover {
      background-color: #27ae60;
    }
    
    .warning-button {
      background-color: #f39c12;
    }
    
    .warning-button:hover {
      background-color: #e67e22;
    }
    
    .danger-button {
      background-color: #e74c3c;
    }
    
    .danger-button:hover {
      background-color: #c0392b;
    }
    
    .info-button {
      background-color: #1abc9c;
    }
    
    .info-button:hover {
      background-color: #16a085;
    }
    
    .window-info {
      background-color: #ecf0f1;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .flex-container {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .half-width {
      flex: 1;
    }
    
    .third-width {
      flex: 1;
    }
    
    .window-controls {
      background-color: #e3f2fd;
      padding: 20px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    
    .status-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #2c3e50;
      color: white;
      padding: 8px 20px;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .status-info {
      display: flex;
      gap: 20px;
    }
    
    .control-panel {
      background-color: #fff;
      padding: 20px;
      border-radius: 6px;
      border: 1px solid #ddd;
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }
    
    input {
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 100%;
      box-sizing: border-box;
    }
    
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .input-group input {
      flex: 1;
      margin-bottom: 0;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .checkbox-group input {
      width: auto;
      margin-bottom: 0;
    }
    
    .checkbox-group label {
      margin-bottom: 0;
    }
    
    .code-block {
      background-color: #2c3e50;
      color: #ecf0f1;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      overflow-x: auto;
      margin: 15px 0;
    }
    
    .note {
      background-color: #fff3cd;
      padding: 15px;
      border-radius: 4px;
      border-left: 4px solid #ffc107;
      margin: 15px 0;
      font-size: 14px;
    }
    
    .window-list {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 10px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .window-item {
      padding: 8px 12px;
      margin: 2px 0;
      background-color: #fff;
      border-radius: 3px;
      border-left: 3px solid #3498db;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .window-item:hover {
      background-color: #e3f2fd;
    }
    
    .window-item.active {
      border-left-color: #2ecc71;
      background-color: #d4edda;
    }
    
    @media (max-width: 768px) {
      .flex-container {
        flex-direction: column;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      .status-bar {
        flex-direction: column;
        gap: 5px;
        padding: 10px;
      }
      
      .status-info {
        flex-wrap: wrap;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Electron 窗口管理示例</h1>
    
    <div class="note">
      <strong>提示：</strong> 这是一个Electron窗口管理示例应用，演示了窗口的创建、控制、事件处理以及多窗口管理功能。
    </div>
    
    <!-- 窗口信息显示 -->
    <div class="section">
      <h2>窗口信息</h2>
      <div id="window-info" class="window-info">
        窗口信息将显示在这里...
      </div>
      <button id="refresh-info" class="info-button">刷新窗口信息</button>
    </div>
    
    <!-- 多窗口管理 -->
    <div class="section">
      <h2>多窗口管理</h2>
      <div class="flex-container">
        <div class="half-width">
          <h3>创建新窗口</h3>
          <div class="control-panel">
            <button id="create-standard-window" class="success-button">创建标准窗口</button>
            <button id="create-modal-window" class="warning-button">创建模态窗口</button>
            <button id="create-large-window" class="info-button">创建大型窗口</button>
            <button id="create-small-window" class="secondary-button">创建小型窗口</button>
            <button id="close-all-windows" class="danger-button">关闭所有辅助窗口</button>
          </div>
        </div>
        <div class="half-width">
          <h3>打开的窗口</h3>
          <div id="window-list" class="window-list">
            <!-- 窗口列表将在这里动态生成 -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- 窗口控制 -->
    <div class="section">
      <h2>窗口控制</h2>
      <div class="window-controls">
        <div class="flex-container">
          <div class="third-width">
            <h3>基本控制</h3>
            <div class="button-group">
              <button id="minimize-window" class="secondary-button">最小化</button>
              <button id="maximize-window" class="secondary-button">最大化</button>
              <button id="restore-window" class="secondary-button">恢复</button>
              <button id="center-window" class="info-button">居中</button>
              <button id="toggle-dev-tools" class="warning-button">开发者工具</button>
            </div>
          </div>
          
          <div class="third-width">
            <h3>窗口状态</h3>
            <div class="checkbox-group">
              <input type="checkbox" id="always-on-top" />
              <label for="always-on-top">总在最顶层</label>
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="fullscreen" />
              <label for="fullscreen">全屏模式</label>
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="flash-frame" />
              <label for="flash-frame">闪烁窗口</label>
            </div>
          </div>
          
          <div class="third-width">
            <h3>导航控制</h3>
            <div class="button-group">
              <button id="navigate-back" class="secondary-button">后退</button>
              <button id="navigate-forward" class="secondary-button">前进</button>
              <button id="reload-window" class="secondary-button">刷新</button>
              <button id="load-url-button" class="info-button">加载URL</button>
              <input type="text" id="url-input" placeholder="输入URL..." />
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 窗口尺寸和位置 -->
    <div class="section">
      <h2>窗口尺寸和位置</h2>
      <div class="control-panel">
        <div class="flex-container">
          <div class="half-width">
            <h3>设置窗口尺寸</h3>
            <div class="input-group">
              <input type="number" id="width-input" placeholder="宽度" />
              <input type="number" id="height-input" placeholder="高度" />
            </div>
            <button id="resize-window" class="success-button">调整尺寸</button>
          </div>
          <div class="half-width">
            <h3>设置窗口位置</h3>
            <div class="input-group">
              <input type="number" id="x-input" placeholder="X坐标" />
              <input type="number" id="y-input" placeholder="Y坐标" />
            </div>
            <button id="move-window" class="success-button">移动窗口</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 代码示例 -->
    <div class="section">
      <h2>核心概念</h2>
      <div class="note">
        <strong>窗口管理核心概念：</strong>
        <ul>
          <li>每个Electron应用至少有一个主窗口和一个主进程</li>
          <li>可以创建多个渲染进程（多个窗口）</li>
          <li>窗口间通过IPC（进程间通信）进行通信</li>
          <li>窗口状态可以持久化保存（大小、位置等）</li>
          <li>安全的窗口管理需要正确配置webPreferences</li>
        </ul>
      </div>
      <div class="code-block">
// 创建窗口的基本代码示例
const { BrowserWindow } = require('electron')

const win = new BrowserWindow({
  width: 800,
  height: 600,
  webPreferences: {
    preload: path.join(__dirname, 'preload.js'),
    nodeIntegration: false,
    contextIsolation: true
  }
})

win.loadFile('index.html')
      </div>
    </div>
  </div>
  
  <!-- 状态栏 -->
  <div class="status-bar">
    <div class="status-info">
      <span id="window-count">窗口数量: 1</span>
      <span id="window-status">状态: 就绪</span>
    </div>
    <div>
      <button id="close-window" class="danger-button">关闭窗口</button>
    </div>
  </div>
  
  <script>
    // 更新窗口信息显示
    async function updateWindowInfo() {
      try {
        const info = await window.electronWindowAPI.getWindowState();
        const bounds = await window.electronWindowAPI.getWindowBounds();
        
        const formattedInfo = {
          windowState: info,
          bounds: bounds,
          timestamp: new Date().toLocaleString()
        };
        
        document.getElementById('window-info').textContent = 
          JSON.stringify(formattedInfo, null, 2);
        
        // 更新状态栏信息
        document.getElementById('window-count').textContent = 
          `窗口数量: ${info?.windowCount || 1}`;
          
        // 更新窗口列表
        updateWindowList(info?.secondaryWindows || []);
      } catch (error) {
        console.error('获取窗口信息失败:', error);
        document.getElementById('window-info').textContent = 
          `获取窗口信息失败: ${error.message}`;
      }
    }
    
    // 更新窗口列表显示
    function updateWindowList(windowIds) {
      const windowListElement = document.getElementById('window-list');
      windowListElement.innerHTML = '';
      
      // 添加主窗口
      const mainWindowItem = document.createElement('div');
      mainWindowItem.className = 'window-item active';
      mainWindowItem.textContent = '主窗口 (当前)';
      windowListElement.appendChild(mainWindowItem);
      
      // 添加辅助窗口
      windowIds.forEach(id => {
        const windowItem = document.createElement('div');
        windowItem.className = 'window-item';
        windowItem.textContent = `辅助窗口: ${id}`;
        windowItem.addEventListener('click', () => {
          // 这里可以添加窗口切换逻辑
          console.log('切换到窗口:', id);
        });
        windowListElement.appendChild(windowItem);
      });
    }
    
    // 设置窗口控制按钮事件
    function setupWindowControlButtons() {
      // 基本控制按钮
      document.getElementById('minimize-window').addEventListener('click', () => {
        window.electronWindowAPI.minimizeWindow();
        updateWindowInfo();
      });
      
      document.getElementById('maximize-window').addEventListener('click', () => {
        window.electronWindowAPI.maximizeWindow();
        updateWindowInfo();
      });
      
      document.getElementById('restore-window').addEventListener('click', () => {
        window.electronWindowAPI.restoreWindow();
        updateWindowInfo();
      });
      
      document.getElementById('center-window').addEventListener('click', () => {
        window.electronWindowAPI.centerWindow();
        updateWindowInfo();
      });
      
      document.getElementById('close-window').addEventListener('click', () => {
        window.electronWindowAPI.closeWindow();
      });
      
      // 刷新信息按钮
      document.getElementById('refresh-info').addEventListener('click', updateWindowInfo);
      
      // 开发者工具
      document.getElementById('toggle-dev-tools').addEventListener('click', () => {
        window.electronWindowAPI.toggleDevTools();
      });
      
      // 导航控制
      document.getElementById('navigate-back').addEventListener('click', () => {
        window.electronWindowAPI.navigateBack();
      });
      
      document.getElementById('navigate-forward').addEventListener('click', () => {
        window.electronWindowAPI.navigateForward();
      });
      
      document.getElementById('reload-window').addEventListener('click', () => {
        window.electronWindowAPI.reloadWindow();
      });
      
      document.getElementById('load-url-button').addEventListener('click', () => {
        const url = document.getElementById('url-input').value.trim();
        if (url) {
          // 如果不是完整URL，尝试添加http://前缀
          const fullUrl = url.startsWith('http') ? url : `http://${url}`;
          window.electronWindowAPI.loadURL(fullUrl);
        }
      });
    }
    
    // 设置窗口状态复选框
    function setupWindowStateCheckboxes() {
      // 总在最顶层
      document.getElementById('always-on-top').addEventListener('change', (e) => {
        window.electronWindowAPI.setWindowAlwaysOnTop(e.target.checked);
        updateWindowInfo();
      });
      
      // 全屏模式
      document.getElementById('fullscreen').addEventListener('change', (e) => {
        window.electronWindowAPI.setFullScreen(e.target.checked);
        updateWindowInfo();
      });
      
      // 闪烁窗口
      document.getElementById('flash-frame').addEventListener('change', (e) => {
        window.electronWindowAPI.flashFrame(e.target.checked);
      });
    }
    
    // 设置尺寸和位置控制
    function setupSizePositionControls() {
      // 调整窗口尺寸
      document.getElementById('resize-window').addEventListener('click', () => {
        const width = parseInt(document.getElementById('width-input').value);
        const height = parseInt(document.getElementById('height-input').value);
        
        if (!isNaN(width) && !isNaN(height) && width > 0 && height > 0) {
          window.electronWindowAPI.resizeWindow(width, height);
          updateWindowInfo();
        }
      });
      
      // 移动窗口位置
      document.getElementById('move-window').addEventListener('click', () => {
        const x = parseInt(document.getElementById('x-input').value);
        const y = parseInt(document.getElementById('y-input').value);
        
        if (!isNaN(x) && !isNaN(y)) {
          window.electronWindowAPI.moveWindow(x, y);
          updateWindowInfo();
        }
      });
    }
    
    // 设置多窗口管理按钮
    function setupMultiWindowButtons() {
      // 创建标准窗口
      document.getElementById('create-standard-window').addEventListener('click', () => {
        window.electronWindowAPI.createNewWindow({
          title: '标准辅助窗口',
          width: 600,
          height: 400
        });
      });
      
      // 创建模态窗口
      document.getElementById('create-modal-window').addEventListener('click', () => {
        window.electronWindowAPI.createNewWindow({
          title: '模态辅助窗口',
          width: 500,
          height: 300,
          modal: true
        });
      });
      
      // 创建大型窗口
      document.getElementById('create-large-window').addEventListener('click', () => {
        window.electronWindowAPI.createNewWindow({
          title: '大型辅助窗口',
          width: 1000,
          height: 700
        });
      });
      
      // 创建小型窗口
      document.getElementById('create-small-window').addEventListener('click', () => {
        window.electronWindowAPI.createNewWindow({
          title: '小型辅助窗口',
          width: 400,
          height: 300
        });
      });
      
      // 关闭所有辅助窗口
      document.getElementById('close-all-windows').addEventListener('click', () => {
        if (confirm('确定要关闭所有辅助窗口吗？')) {
          window.electronWindowAPI.closeAllWindows();
        }
      });
    }
    
    // 设置窗口状态变化监听
    function setupWindowStateListener() {
      // 监听窗口状态变化
      window.electronWindowAPI.onWindowStateChange((state) => {
        console.log('窗口状态变化:', state);
        updateWindowInfo();
        
        // 更新状态栏状态信息
        if (state) {
          const statusText = state.focused ? '状态: 已聚焦' : '状态: 未聚焦';
          document.getElementById('window-status').textContent = statusText;
        }
      });
    }
    
    // 初始化应用
    function initApp() {
      console.log('Electron窗口管理示例页面已加载');
      
      // 设置按钮事件
      setupWindowControlButtons();
      setupWindowStateCheckboxes();
      setupSizePositionControls();
      setupMultiWindowButtons();
      
      // 设置事件监听
      setupWindowStateListener();
      
      // 初始更新窗口信息
      updateWindowInfo();
      
      // 定期更新窗口信息（每秒）
      setInterval(updateWindowInfo, 1000);
    }
    
    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>